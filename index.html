
<!doctype html>

<html lang="es">

<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Flybondi - Challenge</title>
    <link rel="stylesheet" href="styles.css">

</head>

<body>

  <div class="container">
    <header>
      <h1>Buscador de paquetes de ida y vuelta</h1>
    </header>

    <section class="search">
      <div class="controls">
        <div>
          <label for="origin">Origen:</label>
          <select id="origin"></select>
        </div>
        <div>
          <label for="budget">Presupuesto total (ARS):</label>
          <input id="budget" type="number" placeholder="ej: 800" />
        </div>
        <div>
          <label for="minDays">Mínimos días de viaje:</label>
          <input id="minDays" type="number" min="0" placeholder="0" />
        </div>
        <div>
          <label for="sort">Ordenar por:</label>
          <select id="sort">
            <option value="price">Menor precio</option>
            <option value="duration">Menor duración</option>
          </select>
        </div>
        <div style="display:flex;align-items:end;gap:8px">
          <button id="searchBtn">Buscar</button>
          <button id="resetBtn" style="background:#f0f2f6;color:#0b1220">Reset</button>
        </div>
      </div>

      <div id="info" class="results-info">Cargando dataset de ejemplo...</div>
    </section>

    <section id="results" aria-live="polite"></section>


  </div>

  <script>

    const FLIGHTS = [
      { id:1, origin: 'Buenos Aires', destination: 'Córdoba', price: 120, availability: 5, date: '2025-10-05' },
      { id:2, origin: 'Córdoba', destination: 'Buenos Aires', price: 110, availability: 3, date: '2025-10-10' },
      { id:3, origin: 'Buenos Aires', destination: 'Mendoza', price: 220, availability: 2, date: '2025-11-01' },
      { id:4, origin: 'Mendoza', destination: 'Buenos Aires', price: 200, availability: 2, date: '2025-11-07' },
      { id:5, origin: 'Buenos Aires', destination: 'Salta', price: 300, availability: 4, date: '2025-12-01' },
      { id:6, origin: 'Salta', destination: 'Buenos Aires', price: 290, availability: 1, date: '2025-12-10' },
      { id:7, origin: 'Buenos Aires', destination: 'Bariloche', price: 450, availability: 2, date: '2025-10-15' },
      { id:8, origin: 'Bariloche', destination: 'Buenos Aires', price: 430, availability: 2, date: '2025-10-22' },
      { id:9, origin: 'Buenos Aires', destination: 'Iguazú', price: 600, availability: 1, date: '2025-10-20' },
      { id:10, origin: 'Iguazú', destination: 'Buenos Aires', price: 610, availability: 1, date: '2025-10-25' },
      { id:11, origin: 'Córdoba', destination: 'Mendoza', price: 150, availability: 2, date: '2025-09-30' },
      { id:12, origin: 'Mendoza', destination: 'Córdoba', price: 140, availability: 2, date: '2025-10-04' }
    ];

    const state = {
      flights: FLIGHTS.slice(),
      combos: []
    };

    function parseDate(s){
      return new Date(s + 'T00:00:00');
    }

    function daysBetween(a,b){
      const ms = Math.abs(b - a);
      return Math.round(ms / (1000*60*60*24));
    }

    const originSel = document.getElementById('origin');
    const budgetInput = document.getElementById('budget');
    const minDaysInput = document.getElementById('minDays');
    const sortSel = document.getElementById('sort');
    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    const info = document.getElementById('info');
    const results = document.getElementById('results');

    function populateOrigins(){
      const origins = Array.from(new Set(state.flights.map(f => f.origin)));
      originSel.innerHTML = '';
      origins.forEach(o => {
        const opt = document.createElement('option'); opt.value = o; opt.textContent = o; originSel.appendChild(opt);
      });
    }

    function generarCombinaciones({origin, presupuesto, minDays}){
      const combos = [];
      const vuelosIda = state.flights.filter(f => f.origin === origin && f.availability > 0);
      const vuelosVuelta = state.flights.filter(f => f.destination === origin && f.availability > 0);

      vuelosIda.forEach(ida => {
        vuelosVuelta.forEach(vuelta => {
          if (ida.destination !== vuelta.origin) return;
          const fechaIda = parseDate(ida.date);
          const fechaVuelta = parseDate(vuelta.date);
          if (fechaVuelta <= fechaIda) return;

          const durationDays = daysBetween(fechaIda, fechaVuelta);
          if (durationDays < minDays) return;

          const total = ida.price + vuelta.price;
          if (total > presupuesto) return;

          if (ida.availability < 1 || vuelta.availability < 1) return;

          combos.push({
            destination: ida.destination,
            ida, vuelta, total, durationDays
          });
        });
      });

      return combos;
    }

    function render(combos){
      results.innerHTML = '';
      if (!combos || combos.length === 0){
        results.innerHTML = '<div class="no-results">No se encontraron paquetes que cumplan los criterios.</div>';
        info.textContent = '0 Opciones';
        return;
      }

      info.textContent = 'Se encontraron ' + combos.length + ' opciones — Clickea en "Reservar" para simular una compra.';

      const grid = document.createElement('div'); grid.className = 'grid';
      combos.forEach(c => {
        const card = document.createElement('article'); card.className = 'card';
        const h = document.createElement('h3'); h.textContent = c.destination; card.appendChild(h);

        const meta = document.createElement('div'); meta.className = 'meta';
        meta.innerHTML = `Ida: ${c.ida.origin} → ${c.ida.destination} • ${c.ida.date} — $${c.ida.price}<br>Vuelta: ${c.vuelta.origin} → ${c.vuelta.destination} • ${c.vuelta.date} — $${c.vuelta.price}`;
        card.appendChild(meta);

        const price = document.createElement('div'); price.className = 'price'; price.textContent = 'Total: $' + c.total; card.appendChild(price);

        const small = document.createElement('div'); small.className = 'small'; small.textContent = `Duración: ${c.durationDays} día(s) • Disponibilidad ida: ${c.ida.availability} • vuelta: ${c.vuelta.availability}`;
        card.appendChild(small);

        const actions = document.createElement('div'); actions.className = 'actions';
        const more = document.createElement('button'); more.textContent = 'Ver detalle'; more.style.background='#fff'; more.style.border='1px solid #e2e6ef'; more.onclick = () => mostrarDetalle(c);
        const book = document.createElement('button'); book.textContent = 'Reservar'; book.onclick = () => reservar(c);
        actions.appendChild(more); actions.appendChild(book);
        card.appendChild(actions);

        grid.appendChild(card);
      });

      results.appendChild(grid);
    }

    function mostrarDetalle(c){
      alert(`Destino: ${c.destination}\nIda: ${c.ida.date} ($${c.ida.price})\nVuelta: ${c.vuelta.date} ($${c.vuelta.price})\nTotal: $${c.total}\nDuración: ${c.durationDays} días\n\nIDs: ida=${c.ida.id}, vuelta=${c.vuelta.id}`);
    }

    function reservar(combo){
      if (combo.ida.availability < 1 || combo.vuelta.availability < 1){
        alert('Lo siento, ya no hay disponibilidad en una de las tramos');
        return;
      }
      if (!confirm(`Reservar paquete a ${combo.destination} por $${combo.total}?`)) return;

      const idaIdx = state.flights.findIndex(f => f.id === combo.ida.id);
      const vueltaIdx = state.flights.findIndex(f => f.id === combo.vuelta.id);
      if (idaIdx >= 0) state.flights[idaIdx].availability -= 1;
      if (vueltaIdx >= 0) state.flights[vueltaIdx].availability -= 1;

      alert('Reserva simulada: ¡hecho! (solo en memoria)');

      triggerSearch();
    }

    function triggerSearch(){
      const origin = originSel.value;
      const presupuesto = Number(budgetInput.value) || 0;
      const minDays = Number(minDaysInput.value) || 0;
      if (!origin){ info.textContent = 'Selecciona un origen'; return; }
      if (presupuesto <= 0){ info.textContent = 'Ingresa un presupuesto mayor a 0'; return; }

      let combos = generarCombinaciones({origin, presupuesto, minDays});

      const sortBy = sortSel.value;
      if (sortBy === 'price') combos.sort((a,b) => a.total - b.total);
      else if (sortBy === 'duration') combos.sort((a,b) => a.durationDays - b.durationDays || a.total - b.total);

      state.combos = combos;
      render(combos);
    }

    function resetAll(){
      state.flights = FLIGHTS.slice();
      budgetInput.value = '';
      minDaysInput.value = '';
      sortSel.value = 'price';
      populateOrigins();
      info.textContent = 'Dataset restaurado. Ingresa presupuesto y busca.';
      results.innerHTML = '';
    }

    searchBtn.addEventListener('click', () => triggerSearch());
    resetBtn.addEventListener('click', () => resetAll());

    (function init(){
      populateOrigins();
      info.textContent = 'Dataset cargado. Selecciona origen, ingresa presupuesto y haz click en Buscar.';
    })();

  </script>
</body>

</html>